========================================
ç ”ç©¶å®¤ãƒã‚¦ãƒã‚¦è“„ç©ã‚·ã‚¹ãƒ†ãƒ  - ã‚³ãƒ¼ãƒ‰å…¨ä½“
========================================

ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã€‘
- Next.js 16 (App Router) + TypeScript
- Firebase (Auth, Firestore)
- Gemini 2.5 Flash API
- å®Œå…¨ç„¡æ–™ã§é‹ç”¨å¯èƒ½

ã€ä¸»ãªæ©Ÿèƒ½ã€‘
1. AIè­°äº‹éŒ²è‡ªå‹•æ•´ç†ï¼ˆGemini APIï¼‰
2. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆBase64ã€500KBåˆ¶é™ï¼‰
3. å¹´åº¦åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»æ¤œç´¢
4. å‰Šé™¤æ©Ÿèƒ½
5. PWAå¯¾å¿œ

========================================

========================================
ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
========================================
./types/index 2.ts
./types/index.ts
./app/archives/page.tsx
./app/minutes/new/page 2.tsx
./app/minutes/new/page.tsx
./app/minutes/[id]/page.tsx
./app/minutes/page.tsx
./app/layout 2.tsx
./app/dashboard/page.tsx
./app/layout.tsx
./app/api/ai/list-models/route.ts
./app/api/ai/process/route.ts
./app/page.tsx
./app/upload/page.tsx
./components/auth/LoginButton.tsx
./components/auth/AuthProvider 2.tsx
./components/auth/AuthProvider.tsx
./components/files/FileUploader.tsx
./components/files/VideoPlayer.tsx
./lib/firebase.ts

========================================
1. package.json - ä¾å­˜é–¢ä¿‚
========================================
{
  "name": "lab-knowledge-system",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "NODE_OPTIONS='--max-old-space-size=4096' next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@google/generative-ai": "^0.24.1",
    "firebase": "^12.7.0",
    "next": "16.1.1",
    "react": "19.2.3",
    "react-dom": "19.2.3",
    "react-firebase-hooks": "^5.1.1"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.1.1",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}

========================================
2. å‹å®šç¾© - types/index.ts
========================================

// å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«

import { Timestamp } from 'firebase/firestore';

// ãƒ¦ãƒ¼ã‚¶ãƒ¼å‹
export interface User {
  id: string;
  email: string;
  name: string;
  createdAt: Timestamp;
}

// æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«å‹
export interface AttachedFile {
  id: string;
  fileName: string;
  fileType: string; // 'pdf' | 'docx' | 'xlsx' | 'pptx' | 'txt' | 'image'
  fileSize: number; // bytes
  fileUrl: string; // Firebase Storage URL
  storagePath: string; // Storageå†…ã®ãƒ‘ã‚¹
  uploadedBy: string; // userId
  uploadedAt: Timestamp;
  description?: string | null; // ãƒ•ã‚¡ã‚¤ãƒ«ã®èª¬æ˜
}

// ToDoé …ç›®ã®è©³ç´°å‹
export interface TodoItem {
  no: number;
  task: string; // ã‚„ã‚‹ã“ã¨
  assignee: string; // èª°ãŒ
  when: string; // ã„ã¤ã‚„ã‚‹ï¼ˆä»Šæ—¥/æ˜æ—¥/â—‹æ›œï¼‰
  deadline: string; // æœŸé™ï¼ˆâ—‹/â—‹ï¼‰
  goal: string; // ã‚´ãƒ¼ãƒ«ï¼ˆã©ã“ã¾ã§çµ‚ã‚ã‚Œã°OKï¼Ÿï¼‰
}

// é€±é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å‹
export interface WeeklySchedule {
  monday?: string;
  tuesday?: string;
  wednesday?: string;
  thursday?: string;
  friday?: string;
  weekend?: string;
}

// ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³é …ç›®å‹
export interface MilestoneItem {
  label: string;
  completed: boolean;
  progress?: number; // é€²æ—ç‡ï¼ˆ0-100ï¼‰
}

// è­°äº‹éŒ²å‹ï¼ˆç ”ç©¶å®¤ç”¨ï¼‰
export interface Minute {
  id: string;
  userId: string;
  inputMode: 'manual'; // æ‰‹å…¥åŠ›ã®ã¿

  // åŸºæœ¬æƒ…å ±
  date: string; // YYYY-MM-DDå½¢å¼
  participants: string[]; // å‚åŠ è€…

  // ç™ºè¡¨ã¾ã§ã®æ—¥æ•°
  midtermDate?: string; // ä¸­é–“ç™ºè¡¨æ—¥ï¼ˆYYYY-MM-DDï¼‰
  finalDate?: string; // æœ€çµ‚ç™ºè¡¨æ—¥ï¼ˆYYYY-MM-DDï¼‰
  daysToMidterm?: number; // ä¸­é–“ç™ºè¡¨ã¾ã§ã‚ã¨ä½•æ—¥
  daysToFinal?: number; // æœ€çµ‚ç™ºè¡¨ã¾ã§ã‚ã¨ä½•æ—¥
  meetingsToMidterm?: number; // ä¸­é–“ç™ºè¡¨ã¾ã§ã‚ã¨ä½•å›MTG
  meetingsToFinal?: number; // æœ€çµ‚ç™ºè¡¨ã¾ã§ã‚ã¨ä½•å›MTG

  // ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«
  todayGoal: string; // 1è¡Œ

  // Checkï¼ˆå…ˆé€±ã‚„ã£ãŸã“ã¨ï¼‰
  lastWeekActions: string[]; // æœ€å¤§3ã¤

  // Problemï¼ˆå›°ã£ã¦ã‚‹ã“ã¨ï¼‰
  problems: string; // è‡ªç”±è¨˜è¿°

  // Planï¼ˆæ¬¡å›ã¾ã§ã®äºˆå®šï¼‰
  todos: TodoItem[]; // è©³ç´°ToDoãƒªã‚¹ãƒˆ
  weeklySchedule?: WeeklySchedule; // ä»Šé€±ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

  // Doï¼ˆæ¬¡å›æŒã£ã¦ã„ãã‚‚ã®ï¼‰
  nextDeliverables: {
    figures?: number; // å›³
    tables?: number; // è¡¨
    slides?: number; // ã‚¹ãƒ©ã‚¤ãƒ‰
    words?: number; // æ–‡ç« ï¼ˆå­—æ•°ï¼‰
  };

  // Decisionï¼ˆæ±ºã¾ã£ãŸã“ã¨ï¼‰
  decisions: string[]; // ç®‡æ¡æ›¸ã

  // æ¬¡å›
  nextMeetingDate?: string; // YYYY-MM-DD HH:MM
  nextMeetingGoal: string; // æ¬¡å›ã®ã‚´ãƒ¼ãƒ«

  // ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
  midtermMilestones: MilestoneItem[]; // ä¸­é–“ç™ºè¡¨ã¾ã§ã®éšæ®µ
  finalMilestones: MilestoneItem[]; // æœ€çµ‚ç™ºè¡¨ã¾ã§ã®éšæ®µ

  // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
  attachedFiles?: AttachedFile[]; // é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆWord/PDF/Excelç­‰ï¼‰

  // ãƒ¡ã‚¿æƒ…å ±
  tags: string[];
  status: 'draft' | 'confirmed';
  createdAt: Timestamp;
  updatedAt: Timestamp;
}

// ç·¨é›†å±¥æ­´å‹
export interface EditHistory {
  id: string;
  minuteId: string;
  userId: string;
  fieldName: string;
  oldValue: string;
  newValue: string;
  editedAt: Timestamp;
}

// è­°äº‹éŒ²ä½œæˆãƒ•ã‚©ãƒ¼ãƒ ç”¨ã®å‹
export interface MinuteFormData {
  inputText: string; // æ‰‹å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆï¼ˆAIå‡¦ç†å‰ï¼‰
  date: string;
  participants: string[];
  midtermDate?: string;
  finalDate?: string;
  todayGoal: string;
  lastWeekActions: string[];
  problems: string;
  todos: TodoItem[];
  weeklySchedule?: WeeklySchedule;
  nextDeliverables: {
    figures?: number;
    tables?: number;
    slides?: number;
    words?: number;
  };
  decisions: string[];
  nextMeetingDate?: string;
  nextMeetingGoal: string;
  midtermMilestones: MilestoneItem[];
  finalMilestones: MilestoneItem[];
  tags: string[];
}

// AIæ•´ç†çµæœã®å‹ï¼ˆç ”ç©¶å®¤ç”¨ï¼‰
export interface AIProcessedMinute {
  date: string;
  participants: string[];
  todayGoal: string;
  lastWeekActions: string[]; // æœ€å¤§3ã¤
  problems: string;
  todos: TodoItem[];
  decisions: string[];
  nextMeetingGoal: string;
}

========================================
3. Firebaseè¨­å®š - lib/firebase.ts
========================================

import { initializeApp, getApps } from 'firebase/app';
import { getAuth } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';
import { getStorage } from 'firebase/storage';

const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,
};

// Initialize Firebase
const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];

// Firebase services
export const auth = getAuth(app);
export const db = getFirestore(app);
export const storage = getStorage(app);

========================================
4. Gemini API - lib/gemini.ts
========================================

// Gemini APIé€£æºãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆREST APIç›´æ¥å‘¼ã³å‡ºã—ï¼‰
import { AIProcessedMinute } from '@/types';

export async function processMinuteWithAI(inputText: string): Promise<AIProcessedMinute> {
  const apiKey = process.env.GEMINI_API_KEY;

  if (!apiKey) {
    throw new Error('GEMINI_API_KEY is not set');
  }

  const prompt = `
ã‚ãªãŸã¯ç ”ç©¶å®¤ã®ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°è­°äº‹éŒ²ã‚’æ•´ç†ã™ã‚‹AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ä»¥ä¸‹ã®è‡ªç”±è¨˜è¿°ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ã€ç ”ç©¶å®¤è­°äº‹éŒ²ã¨ã—ã¦å¿…è¦ãªæƒ…å ±ã‚’æŠ½å‡ºã—ã€JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
å¿…ãšæœ‰åŠ¹ãªJSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚

ã€æŠ½å‡ºé …ç›®ã€‘
1. date: è­°äº‹éŒ²ã®æ—¥ä»˜ï¼ˆYYYY-MM-DDå½¢å¼ã€ãƒ†ã‚­ã‚¹ãƒˆä¸­ã«ãªã‘ã‚Œã°ä»Šæ—¥ã®æ—¥ä»˜ï¼‰
2. participants: å‚åŠ è€…ã®åå‰ï¼ˆé…åˆ—å½¢å¼ã€ä¾‹: ["å±±ç”°", "ä½è—¤", "ç”°ä¸­"]ï¼‰
3. todayGoal: ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«ï¼ˆ1è¡Œã€30æ–‡å­—ä»¥å†…ï¼‰
4. lastWeekActions: å…ˆé€±ã‚„ã£ãŸã“ã¨ãƒ»çµæœï¼ˆé…åˆ—å½¢å¼ã€æœ€å¤§3ã¤ã€å„50æ–‡å­—ä»¥å†…ï¼‰
5. problems: å›°ã£ã¦ã„ã‚‹ã“ã¨ãƒ»è©°ã¾ã£ã¦ã„ã‚‹ã“ã¨ï¼ˆ100æ–‡å­—ä»¥å†…ã€ãªã‘ã‚Œã°ç©ºæ–‡å­—ï¼‰
6. todos: æ¬¡å›ã¾ã§ã®ToDoãƒªã‚¹ãƒˆï¼ˆé…åˆ—å½¢å¼ã€å„é …ç›®ã¯ä»¥ä¸‹ã®å½¢å¼ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰
   - no: ç•ªå·ï¼ˆ1ã‹ã‚‰é †ç•ªï¼‰
   - task: ã‚„ã‚‹ã“ã¨ï¼ˆæˆæœç‰©ã§è¨˜è¿°ã€ä¾‹: "ç®±ã²ã’å›³1æšï¼‹çµè«–1è¡Œ"ï¼‰
   - assignee: èª°ãŒï¼ˆåå‰ï¼‰
   - when: ã„ã¤ã‚„ã‚‹ï¼ˆä¾‹: "ä»Šæ—¥", "æ˜æ—¥", "æ°´æ›œ"ï¼‰
   - deadline: æœŸé™ï¼ˆä¾‹: "12/25", "é‡‘æ›œ18:00"ï¼‰
   - goal: ã‚´ãƒ¼ãƒ«ï¼ˆã©ã“ã¾ã§çµ‚ã‚ã‚Œã°OKï¼Ÿï¼‰
7. decisions: æ±ºã¾ã£ãŸã“ã¨ï¼ˆé…åˆ—å½¢å¼ã€å„30æ–‡å­—ä»¥å†…ï¼‰
8. nextMeetingGoal: æ¬¡å›ã®ã‚´ãƒ¼ãƒ«ï¼ˆ1è¡Œã€30æ–‡å­—ä»¥å†…ï¼‰

ã€é‡è¦ãªæŒ‡ç¤ºã€‘
- ToDoã¯å¿…ãšã€Œæˆæœç‰©ã€ã§è¨˜è¿°ã™ã‚‹ã“ã¨ï¼ˆÃ—ã€Œè§£æã™ã‚‹ã€â†’ â—‹ã€Œç®±ã²ã’å›³1æšï¼‹çµè«–1è¡Œã€ï¼‰
- æœŸé™ã¯å…·ä½“çš„ãªæ—¥ä»˜ã¾ãŸã¯æ›œæ—¥ã¾ã§è½ã¨ã™ã“ã¨ï¼ˆÃ—ã€Œä»Šé€±ä¸­ã€â†’ â—‹ã€Œé‡‘æ›œ18:00ã€ï¼‰
- æƒ…å ±ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã¯ã€åˆç†çš„ã«æ¨æ¸¬ã—ã¦åŸ‹ã‚ã‚‹ã“ã¨

--- ãƒ†ã‚­ã‚¹ãƒˆ ---
${inputText}

--- å‡ºåŠ›å½¢å¼ï¼ˆå¿…ãšã“ã®JSONå½¢å¼ã§è¿”ã™ã“ã¨ï¼‰ ---
{
  "date": "YYYY-MM-DD",
  "participants": ["å‚åŠ è€…1", "å‚åŠ è€…2"],
  "todayGoal": "ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«",
  "lastWeekActions": ["â‘ ã‚„ã£ãŸã“ã¨ï¼šçµæœ", "â‘¡ã‚„ã£ãŸã“ã¨ï¼šçµæœ"],
  "problems": "å›°ã£ã¦ã„ã‚‹ã“ã¨ï¼ˆãªã‘ã‚Œã°ç©ºæ–‡å­—ï¼‰",
  "todos": [
    {
      "no": 1,
      "task": "ç®±ã²ã’å›³1æšï¼‹èª¬æ˜æ–‡3è¡Œ",
      "assignee": "å±±ç”°",
      "when": "ä»Šæ—¥",
      "deadline": "12/25",
      "goal": "ã‚°ãƒ©ãƒ•1æšå®Œæˆï¼‹èª¬æ˜æ–‡3è¡Œ"
    }
  ],
  "decisions": ["æ±ºã¾ã£ãŸã“ã¨1", "æ±ºã¾ã£ãŸã“ã¨2"],
  "nextMeetingGoal": "æ¬¡å›ã®ã‚´ãƒ¼ãƒ«"
}
`;

  try {
    // REST APIç›´æ¥å‘¼ã³å‡ºã—ï¼ˆv1beta APIä½¿ç”¨ï¼‰
    // æ­£ã—ã„ãƒ¢ãƒ‡ãƒ«å: gemini-2.5-flash (gemini-1.5-flashã¯å­˜åœ¨ã—ãªã„)
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contents: [{
            parts: [{
              text: prompt
            }]
          }]
        })
      }
    );

    if (!response.ok) {
      const errorText = await response.text();
      console.error('Gemini API Response Error:', errorText);
      throw new Error(`Gemini API error: ${response.status} ${response.statusText}`);
    }

    const data = await response.json();
    const text = data.candidates[0].content.parts[0].text;

    // JSONãƒ–ãƒ­ãƒƒã‚¯ã‚’æŠ½å‡ºï¼ˆ```json ... ``` ã®ã‚ˆã†ãªãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã«å¯¾å¿œï¼‰
    const jsonMatch = text.match(/```json\s*([\s\S]*?)\s*```/) || text.match(/\{[\s\S]*\}/);
    const jsonText = jsonMatch ? (jsonMatch[1] || jsonMatch[0]) : text;

    const parsed = JSON.parse(jsonText.trim()) as AIProcessedMinute;

    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    if (!parsed.date || !/^\d{4}-\d{2}-\d{2}$/.test(parsed.date)) {
      parsed.date = new Date().toISOString().split('T')[0];
    }
    if (!Array.isArray(parsed.participants)) {
      parsed.participants = [];
    }
    if (!Array.isArray(parsed.lastWeekActions)) {
      parsed.lastWeekActions = [];
    }
    if (!Array.isArray(parsed.todos)) {
      parsed.todos = [];
    }
    if (!Array.isArray(parsed.decisions)) {
      parsed.decisions = [];
    }

    return parsed;
  } catch (error) {
    console.error('Gemini API ã‚¨ãƒ©ãƒ¼:', error);

    // ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    return {
      date: new Date().toISOString().split('T')[0],
      participants: [],
      todayGoal: 'ï¼ˆAIå‡¦ç†å¤±æ•—ï¼‰',
      lastWeekActions: [],
      problems: 'AIå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§ç·¨é›†ã—ã¦ãã ã•ã„ã€‚',
      todos: [],
      decisions: [],
      nextMeetingGoal: '',
    };
  }
}

========================================
5. èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ - components/auth/AuthProvider.tsx
========================================

'use client';

import { createContext, useContext, useEffect, useState } from 'react';
import { User, onAuthStateChanged, signInWithPopup, GoogleAuthProvider, signOut } from 'firebase/auth';
import { auth } from '@/lib/firebase';

interface AuthContextType {
  user: User | null;
  loading: boolean;
  signInWithGoogle: () => Promise<void>;
  logout: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType>({
  user: null,
  loading: true,
  signInWithGoogle: async () => {},
  logout: async () => {},
});

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, (user) => {
      setUser(user);
      setLoading(false);
    });

    return () => unsubscribe();
  }, []);

  const signInWithGoogle = async () => {
    const provider = new GoogleAuthProvider();
    try {
      await signInWithPopup(auth, provider);
    } catch (error) {
      console.error('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  };

  const logout = async () => {
    try {
      await signOut(auth);
    } catch (error) {
      console.error('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  };

  return (
    <AuthContext.Provider value={{ user, loading, signInWithGoogle, logout }}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  return useContext(AuthContext);
}

========================================
6. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼ - components/files/FileUploader.tsx
========================================

'use client';

import { useState } from 'react';
import { AttachedFile } from '@/types';
import { Timestamp } from 'firebase/firestore';

interface FileUploaderProps {
  userId: string;
  onFileUploaded: (file: AttachedFile) => void;
  acceptedTypes?: string;
  maxSizeMB?: number;
}

export default function FileUploader({
  userId,
  onFileUploaded,
  acceptedTypes = '.pdf,.docx,.xlsx,.pptx,.txt,.png,.jpg,.jpeg',
  maxSizeMB = 0.5, // Firestoreåˆ¶é™ã®ãŸã‚500KBã«å¤‰æ›´ï¼ˆBase64åŒ–å¾Œã‚‚ä½™è£•ã‚’æŒã£ã¦1MBä»¥å†…ï¼‰
}: FileUploaderProps) {
  const [uploading, setUploading] = useState(false);
  const [uploadProgress, setUploadProgress] = useState(0);
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const [description, setDescription] = useState('');

  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
    const maxSize = maxSizeMB * 1024 * 1024;
    if (file.size > maxSize) {
      const sizeInKB = Math.round(maxSizeMB * 1024);
      alert(`ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯${sizeInKB}KBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„\nï¼ˆFirestoreç„¡æ–™ç‰ˆã®åˆ¶é™ï¼šBase64åŒ–å¾Œ1MBä»¥å†…ï¼‰`);
      return;
    }

    setSelectedFile(file);
    setDescription('');
  };

  const getFileType = (fileName: string): string => {
    const ext = fileName.split('.').pop()?.toLowerCase() || '';
    const typeMap: { [key: string]: string } = {
      pdf: 'pdf',
      doc: 'docx',
      docx: 'docx',
      xls: 'xlsx',
      xlsx: 'xlsx',
      ppt: 'pptx',
      pptx: 'pptx',
      txt: 'txt',
      png: 'image',
      jpg: 'image',
      jpeg: 'image',
      gif: 'image',
    };
    return typeMap[ext] || 'other';
  };

  const fileToBase64 = (file: File): Promise<string> => {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result as string);
      reader.onerror = (error) => reject(error);
    });
  };

  const handleUpload = async () => {
    if (!selectedFile) {
      alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
      return;
    }

    setUploading(true);
    setUploadProgress(0);

    try {
      // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Base64ã«å¤‰æ›
      setUploadProgress(30);
      const base64Data = await fileToBase64(selectedFile);

      setUploadProgress(60);
      const timestamp = Date.now();
      const fileName = selectedFile.name;

      const attachedFile: AttachedFile = {
        id: `file_${timestamp}`,
        fileName: fileName,
        fileType: getFileType(fileName),
        fileSize: selectedFile.size,
        fileUrl: base64Data, // Base64ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥ä¿å­˜
        storagePath: `firestore/${userId}/${timestamp}_${fileName}`, // å‚ç…§ç”¨
        uploadedBy: userId,
        uploadedAt: Timestamp.now(),
        description: description.trim() || null,
      };

      setUploadProgress(90);

      onFileUploaded(attachedFile);

      setUploadProgress(100);

      // ãƒªã‚»ãƒƒãƒˆ
      setTimeout(() => {
        setSelectedFile(null);
        setDescription('');
        setUploadProgress(0);
        setUploading(false);
        alert('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
      }, 500);

    } catch (error) {
      console.error('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
      alert('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ');
      setUploading(false);
      setUploadProgress(0);
    }
  };

  const handleCancel = () => {
    setSelectedFile(null);
    setDescription('');
    setUploadProgress(0);
  };

  return (
    <div className="border-2 border-dashed border-gray-300 rounded-lg p-6">
      <h4 className="font-bold text-gray-700 mb-4">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h4>
      <p className="text-xs text-red-600 font-semibold mb-3">
        âš ï¸ é‡è¦ï¼šæœ€å¤§500KBã¾ã§ï¼ˆFirestoreç„¡æ–™ç‰ˆã®åˆ¶é™ï¼‰
      </p>
      <p className="text-xs text-gray-500 mb-3">
        ğŸ’¡ ãƒ’ãƒ³ãƒˆï¼šPDFã¯åœ§ç¸®ã€Wordã¯ç”»åƒã‚’æ¸›ã‚‰ã™ã¨å°ã•ããªã‚Šã¾ã™
      </p>

      {!selectedFile ? (
        <div>
          <label className="block">
            <div className="flex items-center justify-center w-full h-32 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition">
              <div className="text-center">
                <p className="text-gray-600 mb-2">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</p>
                <p className="text-xs text-gray-500">
                  Word, PDF, Excel, PowerPoint, ç”»åƒ
                </p>
                <p className="text-xs text-red-600 font-semibold">
                  æœ€å¤§500KB
                </p>
              </div>
            </div>
            <input
              type="file"
              onChange={handleFileSelect}
              accept={acceptedTypes}
              className="hidden"
            />
          </label>
        </div>
      ) : (
        <div>
          {/* é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ± */}
          <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
            <div className="flex items-start justify-between mb-2">
              <div className="flex-1">
                <p className="font-semibold text-blue-900">{selectedFile.name}</p>
                <p className="text-sm text-blue-700">
                  {getFileType(selectedFile.name)} â€¢ {(selectedFile.size / 1024).toFixed(1)} KB
                </p>
              </div>
              <button
                onClick={handleCancel}
                className="text-red-600 hover:text-red-800 text-sm font-semibold"
                disabled={uploading}
              >
                âœ• ã‚­ãƒ£ãƒ³ã‚»ãƒ«
              </button>
            </div>

            {/* ãƒ•ã‚¡ã‚¤ãƒ«ã®èª¬æ˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ */}
            <div className="mt-3">
              <label className="block text-sm font-medium text-gray-700 mb-1">
                èª¬æ˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
              </label>
              <input
                type="text"
                value={description}
                onChange={(e) => setDescription(e.target.value)}
                placeholder="ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®èª¬æ˜ã‚’å…¥åŠ›..."
                className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"
                disabled={uploading}
              />
            </div>
          </div>

          {/* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é€²æ— */}
          {uploading && (
            <div className="mb-4">
              <div className="flex justify-between text-sm text-gray-600 mb-1">
                <span>å‡¦ç†ä¸­...</span>
                <span>{uploadProgress}%</span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-2">
                <div
                  className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                  style={{ width: `${uploadProgress}%` }}
                ></div>
              </div>
            </div>
          )}

          {/* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ */}
          <button
            onClick={handleUpload}
            disabled={uploading}
            className={`w-full py-3 rounded-lg font-semibold ${
              uploading
                ? 'bg-gray-400 cursor-not-allowed'
                : 'bg-blue-600 hover:bg-blue-700 text-white'
            }`}
          >
            {uploading ? `å‡¦ç†ä¸­... ${uploadProgress}%` : 'ğŸ“¤ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰'}
          </button>
        </div>
      )}
    </div>
  );
}

========================================
7. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - app/dashboard/page.tsx
========================================

'use client';

import { useAuth } from '@/components/auth/AuthProvider';
import { useRouter } from 'next/navigation';
import { useEffect } from 'react';

export default function Dashboard() {
  const { user, loading, logout } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (!loading && !user) {
      router.push('/');
    }
  }, [user, loading, router]);

  const handleLogout = async () => {
    try {
      await logout();
      router.push('/');
    } catch (error) {
      console.error('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:', error);
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <p className="text-gray-600">èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    );
  }

  if (!user) {
    return null;
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <header className="bg-white shadow">
        <div className="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8 flex justify-between items-center">
          <h1 className="text-2xl font-bold text-gray-900">
            ç ”ç©¶å®¤ãƒã‚¦ãƒã‚¦è“„ç©ã‚·ã‚¹ãƒ†ãƒ 
          </h1>
          <div className="flex items-center gap-4">
            <div className="text-right">
              <p className="text-sm text-gray-600">ãƒ­ã‚°ã‚¤ãƒ³ä¸­</p>
              <p className="text-sm font-semibold text-gray-900">{user.email}</p>
            </div>
            <button
              onClick={handleLogout}
              className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"
            >
              ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
            </button>
          </div>
        </div>
      </header>

      {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
      <main className="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
        <div className="mb-8">
          <h2 className="text-3xl font-bold text-gray-900 mb-2">
            ã‚ˆã†ã“ãã€{user.displayName || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼'}ã•ã‚“
          </h2>
          <p className="text-gray-600">
            è­°äº‹éŒ²ã®ä½œæˆãƒ»ç®¡ç†ãƒ»æ¤œç´¢ã‚’ã‚¹ãƒãƒ¼ãƒˆã«è¡Œã„ã¾ã—ã‚‡ã†
          </p>
        </div>

        {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ‰ */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          {/* æ–°è¦è­°äº‹éŒ²ä½œæˆ */}
          <button
            onClick={() => router.push('/minutes/new')}
            className="bg-white p-6 rounded-lg shadow hover:shadow-lg transition text-left"
          >
            <div className="text-4xl mb-3">âœï¸</div>
            <h3 className="text-xl font-bold text-gray-900 mb-2">
              æ–°è¦è­°äº‹éŒ²ä½œæˆ
            </h3>
            <p className="text-gray-600">
              ã‚¼ãƒŸå¾Œã«ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã€AIãŒè‡ªå‹•æ•´ç†
            </p>
          </button>

          {/* ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ */}
          <button
            onClick={() => router.push('/upload')}
            className="bg-gradient-to-br from-purple-50 to-pink-50 border-2 border-purple-300 p-6 rounded-lg shadow hover:shadow-lg transition text-left"
          >
            <div className="text-4xl mb-3">ğŸ“¤</div>
            <h3 className="text-xl font-bold text-purple-900 mb-2">
              ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            </h3>
            <p className="text-purple-700 font-medium">
              è³‡æ–™ãƒ»å‹•ç”»ã‚’ç›´æ¥ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            </p>
          </button>

          {/* éå»ã®è­°äº‹éŒ²ã‚’è¦‹ã‚‹ */}
          <button
            onClick={() => router.push('/minutes')}
            className="bg-white p-6 rounded-lg shadow hover:shadow-lg transition text-left"
          >
            <div className="text-4xl mb-3">ğŸ“š</div>
            <h3 className="text-xl font-bold text-gray-900 mb-2">
              éå»ã®è­°äº‹éŒ²ã‚’è¦‹ã‚‹
            </h3>
            <p className="text-gray-600">
              éå»ã®ãƒã‚¦ãƒã‚¦ã‚’æ¤œç´¢ãƒ»é–²è¦§
            </p>
          </button>

          {/* å…ˆè¼©ã®è³‡æ–™ãƒ»å‹•ç”» */}
          <button
            onClick={() => router.push('/archives')}
            className="bg-white p-6 rounded-lg shadow hover:shadow-lg transition text-left"
          >
            <div className="text-4xl mb-3">ğŸ¥</div>
            <h3 className="text-xl font-bold text-gray-900 mb-2">
              å…ˆè¼©ã®è³‡æ–™ãƒ»å‹•ç”»
            </h3>
            <p className="text-gray-600">
              ç ”ç©¶ç™ºè¡¨å‹•ç”»ã‚„ãƒã‚¦ãƒã‚¦è³‡æ–™ã‚’é–²è¦§
            </p>
          </button>
        </div>

        {/* ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ */}
        <div className="bg-white rounded-lg shadow p-6">
          <h3 className="text-xl font-bold text-gray-900 mb-4">ğŸ“– ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h3>
          <div className="space-y-4">
            <div className="flex items-start gap-3">
              <span className="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold">
                1
              </span>
              <div>
                <h4 className="font-semibold text-gray-900">è­°äº‹éŒ²ã‚’ä½œæˆ</h4>
                <p className="text-sm text-gray-600">
                  ã€Œæ–°è¦è­°äº‹éŒ²ä½œæˆã€ã‹ã‚‰ã€ã‚¼ãƒŸã®å†…å®¹ã‚’ãƒ†ã‚­ã‚¹ãƒˆã§å…¥åŠ›ã—ã¾ã™ã€‚AIãŒè‡ªå‹•ã§æ•´ç†ã—ã¦ãã‚Œã¾ã™ã€‚
                </p>
              </div>
            </div>
            <div className="flex items-start gap-3">
              <span className="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold">
                2
              </span>
              <div>
                <h4 className="font-semibold text-gray-900">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h4>
                <p className="text-sm text-gray-600">
                  Wordã€PDFã€Excelã€å‹•ç”»ãªã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è­°äº‹éŒ²ã«æ·»ä»˜ã§ãã¾ã™ã€‚å…ˆè¼©ã®ç ”ç©¶ç™ºè¡¨å‹•ç”»ã‚‚ä¿å­˜å¯èƒ½ã€‚
                </p>
              </div>
            </div>
            <div className="flex items-start gap-3">
              <span className="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold">
                3
              </span>
              <div>
                <h4 className="font-semibold text-gray-900">éå»ã®ãƒã‚¦ãƒã‚¦ã‚’æ¤œç´¢</h4>
                <p className="text-sm text-gray-600">
                  ã€Œéå»ã®è­°äº‹éŒ²ã‚’è¦‹ã‚‹ã€ã‹ã‚‰ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã‚„ã‚¿ã‚°æ¤œç´¢ã§å¿…è¦ãªæƒ…å ±ã‚’ã™ãã«è¦‹ã¤ã‘ã‚‰ã‚Œã¾ã™ã€‚
                </p>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  );
}

========================================
8. ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒšãƒ¼ã‚¸ - app/archives/page.tsxï¼ˆå¹´åº¦åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ï¼‰
========================================

'use client';

import { useAuth } from '@/components/auth/AuthProvider';
import { useRouter } from 'next/navigation';
import { useEffect, useState } from 'react';
import { Minute, AttachedFile } from '@/types';
import { db } from '@/lib/firebase';
import { collection, query, where, orderBy, getDocs, doc, deleteDoc } from 'firebase/firestore';
import VideoPlayer from '@/components/files/VideoPlayer';

export default function ArchivesPage() {
  const { user, loading } = useAuth();
  const router = useRouter();
  const [minutes, setMinutes] = useState<Minute[]>([]);
  const [loadingData, setLoadingData] = useState(true);
  const [fileTypeFilter, setFileTypeFilter] = useState<'all' | 'video' | 'pdf' | 'docx' | 'xlsx' | 'image'>('all');
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedYear, setSelectedYear] = useState<string>('all');
  const [groupByYear, setGroupByYear] = useState(false);

  useEffect(() => {
    if (!loading && !user) {
      router.push('/');
    }
  }, [user, loading, router]);

  useEffect(() => {
    if (user) {
      fetchArchives();
    }
  }, [user]);

  const fetchArchives = async () => {
    if (!user) return;

    setLoadingData(true);
    try {
      const q = query(
        collection(db, 'minutes'),
        where('userId', '==', user.uid),
        orderBy('createdAt', 'desc')
      );

      const snapshot = await getDocs(q);
      const minutesData = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data(),
      })) as Minute[];

      // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹è­°äº‹éŒ²ã®ã¿
      const withFiles = minutesData.filter(m => m.attachedFiles && m.attachedFiles.length > 0);
      setMinutes(withFiles);
    } catch (error) {
      console.error('ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã®å–å¾—ã«å¤±æ•—:', error);
    } finally {
      setLoadingData(false);
    }
  };

  const handleDeleteMinute = async (minuteId: string, minuteGoal: string) => {
    if (!window.confirm(`ã€Œ${minuteGoal}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) {
      return;
    }

    try {
      await deleteDoc(doc(db, 'minutes', minuteId));
      alert('å‰Šé™¤ã—ã¾ã—ãŸ');
      fetchArchives(); // å†èª­ã¿è¾¼ã¿
    } catch (error) {
      console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
      alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  };

  // ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
  const allFiles = minutes.flatMap(m =>
    (m.attachedFiles || []).map(file => ({
      ...file,
      minuteId: m.id,
      minuteDate: m.date,
      minuteGoal: m.todayGoal,
    }))
  );

  // å¹´åº¦ã®å–å¾—ï¼ˆæ—¥ä»˜ã‹ã‚‰å¹´åº¦ã‚’è¨ˆç®—: 4æœˆå§‹ã¾ã‚Šï¼‰
  const getAcademicYear = (dateString: string): number => {
    const date = new Date(dateString);
    const year = date.getFullYear();
    const month = date.getMonth() + 1; // 0-indexed to 1-indexed
    // 4æœˆä»¥é™ãªã‚‰ç¾åœ¨å¹´åº¦ã€3æœˆä»¥å‰ãªã‚‰å‰å¹´åº¦
    return month >= 4 ? year : year - 1;
  };

  // ã™ã¹ã¦ã®å¹´åº¦ã‚’å–å¾—
  const allYears = Array.from(
    new Set(allFiles.map(f => getAcademicYear(f.minuteDate)))
  ).sort((a, b) => b - a); // é™é †

  // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
  let filteredFiles = allFiles;

  // å¹´åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  if (selectedYear !== 'all') {
    const yearNum = parseInt(selectedYear);
    filteredFiles = filteredFiles.filter(f => getAcademicYear(f.minuteDate) === yearNum);
  }

  if (fileTypeFilter !== 'all') {
    filteredFiles = filteredFiles.filter(f => f.fileType === fileTypeFilter);
  }

  if (searchQuery.trim()) {
    const query = searchQuery.toLowerCase();
    filteredFiles = filteredFiles.filter(f =>
      f.fileName.toLowerCase().includes(query) ||
      f.description?.toLowerCase().includes(query) ||
      f.minuteGoal?.toLowerCase().includes(query)
    );
  }

  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—åˆ¥ã®ä»¶æ•°
  const videosCount = allFiles.filter(f => f.fileType === 'video').length;
  const docsCount = allFiles.filter(f => f.fileType === 'pdf' || f.fileType === 'docx' || f.fileType === 'xlsx' || f.fileType === 'pptx').length;
  const imagesCount = allFiles.filter(f => f.fileType === 'image').length;

  if (loading || loadingData) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <p className="text-gray-600">èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-7xl mx-auto px-4">
        {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
        <div className="flex justify-between items-center mb-6">
          <div>
            <button
              onClick={() => router.push('/dashboard')}
              className="text-blue-600 hover:text-blue-800 mb-2 flex items-center gap-1"
            >
              â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
            </button>
            <h1 className="text-3xl font-bold text-gray-900">å…ˆè¼©ã®è³‡æ–™ãƒ»å‹•ç”»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</h1>
            <p className="text-gray-600 mt-2">
              ç ”ç©¶ç™ºè¡¨å‹•ç”»ã‚„ãƒã‚¦ãƒã‚¦è³‡æ–™ã‚’é–²è¦§ãƒ»æ¤œç´¢ã§ãã¾ã™
            </p>
          </div>
        </div>

        {/* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div className="bg-white p-4 rounded-lg shadow">
            <div className="text-3xl mb-2">ğŸ¥</div>
            <p className="text-sm text-gray-600">å‹•ç”»</p>
            <p className="text-2xl font-bold text-gray-900">{videosCount}ä»¶</p>
          </div>
          <div className="bg-white p-4 rounded-lg shadow">
            <div className="text-3xl mb-2">ğŸ“„</div>
            <p className="text-sm text-gray-600">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</p>
            <p className="text-2xl font-bold text-gray-900">{docsCount}ä»¶</p>
          </div>
          <div className="bg-white p-4 rounded-lg shadow">
            <div className="text-3xl mb-2">ğŸ–¼ï¸</div>
            <p className="text-sm text-gray-600">ç”»åƒ</p>
            <p className="text-2xl font-bold text-gray-900">{imagesCount}ä»¶</p>
          </div>
        </div>

        {/* æ¤œç´¢ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */}
        <div className="bg-white rounded-lg shadow p-4 mb-6">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">å¹´åº¦</label>
              <select
                value={selectedYear}
                onChange={(e) => setSelectedYear(e.target.value)}
                className="w-full p-2 border border-gray-300 rounded-lg"
              >
                <option value="all">ã™ã¹ã¦ã®å¹´åº¦ ({allFiles.length}ä»¶)</option>
                {allYears.map(year => {
                  const yearFiles = allFiles.filter(f => getAcademicYear(f.minuteDate) === year);
                  return (
                    <option key={year} value={year}>
                      {year}å¹´åº¦ ({yearFiles.length}ä»¶)
                    </option>
                  );
                })}
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—</label>
              <select
                value={fileTypeFilter}
                onChange={(e) => setFileTypeFilter(e.target.value as any)}
                className="w-full p-2 border border-gray-300 rounded-lg"
              >
                <option value="all">ã™ã¹ã¦ ({allFiles.length}ä»¶)</option>
                <option value="video">å‹•ç”» ({videosCount}ä»¶)</option>
                <option value="pdf">PDF</option>
                <option value="docx">Word</option>
                <option value="xlsx">Excel</option>
                <option value="image">ç”»åƒ ({imagesCount}ä»¶)</option>
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">æ¤œç´¢</label>
              <input
                type="text"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                placeholder="ãƒ•ã‚¡ã‚¤ãƒ«åã€èª¬æ˜ã§æ¤œç´¢..."
                className="w-full p-2 border border-gray-300 rounded-lg"
              />
            </div>
          </div>

          {/* å¹´åº¦åˆ¥ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ãƒˆã‚°ãƒ« */}
          <div className="flex items-center gap-2">
            <input
              type="checkbox"
              id="groupByYear"
              checked={groupByYear}
              onChange={(e) => setGroupByYear(e.target.checked)}
              className="w-4 h-4 text-blue-600 rounded"
            />
            <label htmlFor="groupByYear" className="text-sm text-gray-700 cursor-pointer">
              å¹´åº¦åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦è¡¨ç¤º
            </label>
          </div>
        </div>

        {/* ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ */}
        {filteredFiles.length === 0 ? (
          <div className="bg-white rounded-lg shadow p-8 text-center">
            <p className="text-gray-600 mb-4">
              {allFiles.length === 0
                ? 'ã¾ã ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“'
                : 'æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“'}
            </p>
            <button
              onClick={() => router.push('/minutes/new')}
              className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
            >
              è­°äº‹éŒ²ã‚’ä½œæˆã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            </button>
          </div>
        ) : groupByYear ? (
          // å¹´åº¦åˆ¥ã‚°ãƒ«ãƒ¼ãƒ—åŒ–è¡¨ç¤º
          <div className="space-y-8">
            {allYears
              .filter(year => filteredFiles.some(f => getAcademicYear(f.minuteDate) === year))
              .map(year => {
                const yearFiles = filteredFiles.filter(f => getAcademicYear(f.minuteDate) === year);
                return (
                  <div key={year} className="bg-white rounded-lg shadow p-6">
                    <h2 className="text-2xl font-bold text-gray-900 mb-4 border-b pb-3">
                      ğŸ“… {year}å¹´åº¦ ({yearFiles.length}ä»¶)
                    </h2>
                    <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                      {yearFiles.map((file: any) => (
                        <div key={file.id} className="border rounded-lg p-3 hover:shadow-md transition">
                          <div className="text-3xl mb-2 text-center">
                            {file.fileType === 'video' && 'ğŸ¥'}
                            {file.fileType === 'pdf' && 'ğŸ“•'}
                            {file.fileType === 'docx' && 'ğŸ“˜'}
                            {file.fileType === 'xlsx' && 'ğŸ“—'}
                            {file.fileType === 'image' && 'ğŸ–¼ï¸'}
                          </div>
                          <p className="text-sm font-semibold text-gray-900 truncate mb-1">
                            {file.fileName}
                          </p>
                          <p className="text-xs text-gray-500 mb-2">{file.minuteDate}</p>
                          <div className="flex gap-1">
                            <a
                              href={file.fileUrl}
                              target="_blank"
                              rel="noopener noreferrer"
                              className="flex-1 text-center px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700"
                            >
                              é–‹ã
                            </a>
                            <button
                              onClick={() => handleDeleteMinute(file.minuteId, file.minuteGoal || file.fileName)}
                              className="px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600"
                              title="å‰Šé™¤"
                            >
                              ğŸ—‘ï¸
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                );
              })}
          </div>
        ) : (
          // é€šå¸¸è¡¨ç¤ºï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—åˆ¥ï¼‰
          <div className="space-y-6">
            {/* å‹•ç”»ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
            {filteredFiles.filter(f => f.fileType === 'video').length > 0 && (
              <div>
                <h2 className="text-xl font-bold text-gray-900 mb-4">ğŸ¥ å‹•ç”»</h2>
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  {filteredFiles.filter(f => f.fileType === 'video').map((file: any) => (
                    <div key={file.id} className="bg-white rounded-lg shadow overflow-hidden">
                      <VideoPlayer videoUrl={file.fileUrl} fileName={file.fileName} />
                      <div className="p-4">
                        <h3 className="font-semibold text-gray-900 mb-2">{file.fileName}</h3>
                        {file.description && (
                          <p className="text-sm text-gray-600 mb-2">{file.description}</p>
                        )}
                        <div className="text-xs text-gray-500 mb-3">
                          <p>è­°äº‹éŒ²: {file.minuteGoal || 'æœªè¨­å®š'}</p>
                          <p>æ—¥ä»˜: {file.minuteDate}</p>
                        </div>
                        <div className="flex gap-2">
                          <button
                            onClick={() => router.push(`/minutes/${file.minuteId}`)}
                            className="flex-1 px-3 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700"
                          >
                            è­°äº‹éŒ²ã‚’è¦‹ã‚‹
                          </button>
                          <button
                            onClick={() => handleDeleteMinute(file.minuteId, file.minuteGoal || file.fileName)}
                            className="px-3 py-2 bg-red-500 text-white text-sm rounded hover:bg-red-600"
                            title="å‰Šé™¤"
                          >
                            ğŸ—‘ï¸
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
            {filteredFiles.filter(f => f.fileType !== 'video' && f.fileType !== 'image').length > 0 && (
              <div>
                <h2 className="text-xl font-bold text-gray-900 mb-4">ğŸ“„ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</h2>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {filteredFiles.filter(f => f.fileType !== 'video' && f.fileType !== 'image').map((file: any) => (
                    <div key={file.id} className="bg-white rounded-lg shadow p-4 hover:shadow-lg transition">
                      <div className="flex items-start justify-between mb-3">
                        <div className="text-3xl">
                          {file.fileType === 'pdf' && 'ğŸ“•'}
                          {file.fileType === 'docx' && 'ğŸ“˜'}
                          {file.fileType === 'xlsx' && 'ğŸ“—'}
                          {file.fileType === 'pptx' && 'ğŸ“™'}
                          {!['pdf', 'docx', 'xlsx', 'pptx'].includes(file.fileType) && 'ğŸ“„'}
                        </div>
                        <span className="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">
                          {file.fileType.toUpperCase()}
                        </span>
                      </div>
                      <h3 className="font-semibold text-gray-900 mb-2">{file.fileName}</h3>
                      {file.description && (
                        <p className="text-sm text-gray-600 mb-2">{file.description}</p>
                      )}
                      <div className="text-xs text-gray-500 mb-3">
                        <p>{(file.fileSize / 1024).toFixed(1)} KB</p>
                        <p>{file.minuteDate}</p>
                      </div>
                      <div className="flex gap-2">
                        <a
                          href={file.fileUrl}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="flex-1 text-center px-3 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700"
                        >
                          é–‹ã
                        </a>
                        <button
                          onClick={() => router.push(`/minutes/${file.minuteId}`)}
                          className="px-3 py-2 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300"
                        >
                          è­°äº‹éŒ²
                        </button>
                        <button
                          onClick={() => handleDeleteMinute(file.minuteId, file.minuteGoal || file.fileName)}
                          className="px-3 py-2 bg-red-500 text-white text-sm rounded hover:bg-red-600"
                          title="å‰Šé™¤"
                        >
                          ğŸ—‘ï¸
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* ç”»åƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
            {filteredFiles.filter(f => f.fileType === 'image').length > 0 && (
              <div>
                <h2 className="text-xl font-bold text-gray-900 mb-4">ğŸ–¼ï¸ ç”»åƒ</h2>
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                  {filteredFiles.filter(f => f.fileType === 'image').map((file: any) => (
                    <div key={file.id} className="bg-white rounded-lg shadow overflow-hidden hover:shadow-lg transition">
                      <img
                        src={file.fileUrl}
                        alt={file.fileName}
                        className="w-full h-48 object-cover"
                      />
                      <div className="p-3">
                        <p className="text-sm font-semibold text-gray-900 truncate">{file.fileName}</p>
                        <p className="text-xs text-gray-500">{file.minuteDate}</p>
                        <div className="flex gap-1 mt-2">
                          <a
                            href={file.fileUrl}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="flex-1 text-center px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700"
                          >
                            é–‹ã
                          </a>
                          <button
                            onClick={() => router.push(`/minutes/${file.minuteId}`)}
                            className="px-2 py-1 bg-gray-200 text-gray-700 text-xs rounded hover:bg-gray-300"
                          >
                            è­°äº‹éŒ²
                          </button>
                          <button
                            onClick={() => handleDeleteMinute(file.minuteId, file.minuteGoal || file.fileName)}
                            className="px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600"
                            title="å‰Šé™¤"
                          >
                            ğŸ—‘ï¸
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        )}
      </div>
    </div>
  );
}

========================================
9. è­°äº‹éŒ²ä½œæˆ - app/minutes/new/page.tsx
========================================

'use client';

import { useAuth } from '@/components/auth/AuthProvider';
import { useRouter } from 'next/navigation';
import { useEffect, useState } from 'react';
import { AIProcessedMinute, TodoItem, MilestoneItem, AttachedFile } from '@/types';
import { db } from '@/lib/firebase';
import { collection, addDoc, serverTimestamp } from 'firebase/firestore';
import FileUploader from '@/components/files/FileUploader';

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
const DEFAULT_MIDTERM_MILESTONES: MilestoneItem[] = [
  { label: 'ãƒ†ãƒ¼ãƒãƒ»ç›®çš„', completed: false },
  { label: 'ç ”ç©¶èƒŒæ™¯', completed: false },
  { label: 'ç ”ç©¶ç›®çš„', completed: false },
  { label: 'ç ”ç©¶ä»®èª¬', completed: false },
  { label: 'ç ”ç©¶ç›®æ¨™', completed: false },
  { label: 'æ¤œè¨¼æ–¹æ³•', completed: false },
  { label: 'æ¤œè¨¼è¨ˆç”»è¡¨', completed: false },
];

const DEFAULT_FINAL_MILESTONES: MilestoneItem[] = [
  { label: 'ãƒ†ãƒ¼ãƒãƒ»ç›®çš„', completed: false },
  { label: 'ç ”ç©¶èƒŒæ™¯', completed: false },
  { label: 'ç ”ç©¶ç›®çš„', completed: false },
  { label: 'ç ”ç©¶ä»®èª¬', completed: false },
  { label: 'ç ”ç©¶ç›®æ¨™', completed: false },
  { label: 'æ¤œè¨¼æ–¹æ³•', completed: false },
  { label: 'æ¤œè¨¼çµæœ', completed: false },
  { label: 'è€ƒå¯Ÿ', completed: false },
  { label: 'çµè«–', completed: false },
  { label: 'ä»Šå¾Œã®èª²é¡Œ', completed: false },
];

export default function NewMinute() {
  const { user, loading } = useAuth();
  const router = useRouter();
  const [inputText, setInputText] = useState('');
  const [processing, setProcessing] = useState(false);
  const [aiResult, setAiResult] = useState<AIProcessedMinute | null>(null);
  const [error, setError] = useState('');
  const [saving, setSaving] = useState(false);

  // åŸºæœ¬æƒ…å ±
  const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
  const [participants, setParticipants] = useState<string[]>([]);
  const [participantInput, setParticipantInput] = useState('');

  // ç™ºè¡¨æ—¥ç¨‹
  const [midtermDate, setMidtermDate] = useState('');
  const [finalDate, setFinalDate] = useState('');

  // ãƒ•ã‚©ãƒ¼ãƒ é …ç›®ï¼ˆå„ªå…ˆé †ä½é †ï¼‰
  const [decisions, setDecisions] = useState<string[]>(['', '']);
  const [todos, setTodos] = useState<TodoItem[]>([]);
  const [nextMeetingDate, setNextMeetingDate] = useState('');
  const [nextMeetingGoal, setNextMeetingGoal] = useState('');
  const [todayGoal, setTodayGoal] = useState('');
  const [lastWeekActions, setLastWeekActions] = useState<string[]>(['', '', '']);
  const [problems, setProblems] = useState('');
  const [nextDeliverablesFigures, setNextDeliverablesFigures] = useState<number>(0);
  const [nextDeliverablesTables, setNextDeliverablesTables] = useState<number>(0);
  const [nextDeliverablesSlides, setNextDeliverablesSlides] = useState<number>(0);
  const [nextDeliverablesWords, setNextDeliverablesWords] = useState<number>(0);
  const [midtermMilestones, setMidtermMilestones] = useState<MilestoneItem[]>(DEFAULT_MIDTERM_MILESTONES);
  const [finalMilestones, setFinalMilestones] = useState<MilestoneItem[]>(DEFAULT_FINAL_MILESTONES);
  const [tags, setTags] = useState<string[]>([]);
  const [tagInput, setTagInput] = useState('');
  const [attachedFiles, setAttachedFiles] = useState<AttachedFile[]>([]);

  // æŠ˜ã‚ŠãŸãŸã¿çŠ¶æ…‹
  const [showDetails, setShowDetails] = useState(false);
  const [showMilestones, setShowMilestones] = useState(false);

  useEffect(() => {
    if (!loading && !user) {
      router.push('/');
    }
  }, [user, loading, router]);

  // AIçµæœã‚’åæ˜ 
  useEffect(() => {
    if (aiResult) {
      setDate(aiResult.date);
      setParticipants(aiResult.participants);
      setTodayGoal(aiResult.todayGoal);
      setLastWeekActions([...aiResult.lastWeekActions, '', '', ''].slice(0, 3));
      setProblems(aiResult.problems);
      setTodos(aiResult.todos);
      setDecisions([...aiResult.decisions, '', '']);
      setNextMeetingGoal(aiResult.nextMeetingGoal);
    }
  }, [aiResult]);

  const handleProcessWithAI = async () => {
    if (inputText.trim().length < 50) {
      setError('æœ€ä½50æ–‡å­—ä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }

    setError('');
    setProcessing(true);

    try {
      const response = await fetch('/api/ai/process', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ inputText }),
      });

      if (!response.ok) {
        throw new Error('AIå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }

      const result: AIProcessedMinute = await response.json();
      setAiResult(result);
    } catch (err) {
      setError('AIå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      console.error(err);
    } finally {
      setProcessing(false);
    }
  };

  const handleSave = async (status: 'draft' | 'confirmed') => {
    if (!user) return;

    if (!todayGoal.trim()) {
      setError('ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«ã¯å¿…é ˆã§ã™');
      return;
    }

    setSaving(true);
    setError('');

    // ç™ºè¡¨ã¾ã§ã®æ—¥æ•°ã‚’è¨ˆç®—
    const today = new Date();
    const calcDaysTo = (targetDate: string) => {
      if (!targetDate) return null;
      const target = new Date(targetDate);
      return Math.ceil((target.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));
    };

    try {
      await addDoc(collection(db, 'minutes'), {
        userId: user.uid,
        inputMode: 'manual',
        date,
        participants: participants.length > 0 ? participants : null,
        midtermDate: midtermDate || null,
        finalDate: finalDate || null,
        daysToMidterm: calcDaysTo(midtermDate),
        daysToFinal: calcDaysTo(finalDate),
        meetingsToMidterm: null,
        meetingsToFinal: null,
        todayGoal: todayGoal.trim(),
        lastWeekActions: lastWeekActions.filter(a => a.trim()).length > 0 ? lastWeekActions.filter(a => a.trim()) : null,
        problems: problems.trim() || null,
        todos: todos.filter(t => t.task.trim()).length > 0 ? todos.filter(t => t.task.trim()) : null,
        weeklySchedule: null,
        nextDeliverables: (nextDeliverablesFigures || nextDeliverablesTables || nextDeliverablesSlides || nextDeliverablesWords) ? {
          figures: nextDeliverablesFigures || null,
          tables: nextDeliverablesTables || null,
          slides: nextDeliverablesSlides || null,
          words: nextDeliverablesWords || null,
        } : null,
        decisions: decisions.filter(d => d.trim()).length > 0 ? decisions.filter(d => d.trim()) : null,
        nextMeetingDate: nextMeetingDate || null,
        nextMeetingGoal: nextMeetingGoal.trim() || null,
        midtermMilestones: midtermMilestones || null,
        finalMilestones: finalMilestones || null,
        attachedFiles: attachedFiles.length > 0 ? attachedFiles : null,
        tags: tags.length > 0 ? tags : null,
        status,
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
      });

      router.push('/dashboard');
    } catch (err) {
      setError('ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      console.error(err);
    } finally {
      setSaving(false);
    }
  };

  const addParticipant = () => {
    if (participantInput.trim() && !participants.includes(participantInput.trim())) {
      setParticipants([...participants, participantInput.trim()]);
      setParticipantInput('');
    }
  };

  const removeParticipant = (index: number) => {
    setParticipants(participants.filter((_, i) => i !== index));
  };

  const addTodo = () => {
    setTodos([
      ...todos,
      {
        no: todos.length + 1,
        task: '',
        assignee: '',
        when: '',
        deadline: '',
        goal: '',
      },
    ]);
  };

  const updateTodo = (index: number, field: keyof TodoItem, value: string | number) => {
    const newTodos = [...todos];
    newTodos[index] = { ...newTodos[index], [field]: value };
    setTodos(newTodos);
  };

  const removeTodo = (index: number) => {
    const newTodos = todos.filter((_, i) => i !== index);
    newTodos.forEach((todo, i) => {
      todo.no = i + 1;
    });
    setTodos(newTodos);
  };

  const addTag = () => {
    if (tagInput.trim() && !tags.includes(tagInput.trim())) {
      setTags([...tags, tagInput.trim()]);
      setTagInput('');
    }
  };

  const removeTag = (index: number) => {
    setTags(tags.filter((_, i) => i !== index));
  };

  const toggleMilestone = (type: 'midterm' | 'final', index: number) => {
    if (type === 'midterm') {
      const newMilestones = [...midtermMilestones];
      newMilestones[index].completed = !newMilestones[index].completed;
      setMidtermMilestones(newMilestones);
    } else {
      const newMilestones = [...finalMilestones];
      newMilestones[index].completed = !newMilestones[index].completed;
      setFinalMilestones(newMilestones);
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <p className="text-gray-600">èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-5xl mx-auto px-4">
        <div className="mb-6">
          <button
            onClick={() => router.push('/dashboard')}
            className="text-blue-600 hover:text-blue-800 flex items-center gap-1"
          >
            â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
          </button>
        </div>
        <h1 className="text-3xl font-bold text-gray-900 mb-2">ç ”ç©¶ä¼šè­° è­°äº‹éŒ²ä½œæˆ</h1>
        <p className="text-sm text-gray-600 mb-8">é‡è¦ãªæƒ…å ±ã‹ã‚‰é †ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>

        {/* Step 1: AIå‡¦ç† */}
        {!aiResult && (
          <div className="bg-white rounded-lg shadow p-6 mb-6">
            <h2 className="text-xl font-semibold text-gray-800 mb-4">
              è­°äº‹éŒ²ã‚’å…¥åŠ›ã—ã¦AIæ•´ç†
            </h2>
            <p className="text-sm text-gray-600 mb-4">
              è‡ªç”±è¨˜è¿°ã§è­°äº‹éŒ²ã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚AIãŒé‡è¦ãªæƒ…å ±ã‚’æ•´ç†ã—ã¾ã™ã€‚
            </p>
            <textarea
              value={inputText}
              onChange={(e) => setInputText(e.target.value)}
              className="w-full h-64 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="ä¾‹:&#10;2024å¹´12æœˆ24æ—¥ã®ç ”ç©¶å®¤MTGã‚’å®Ÿæ–½ã€‚å‚åŠ è€…ã¯å±±ç”°ã€ä½è—¤ã€ç”°ä¸­ã€‚&#10;ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«ã¯ä¸­é–“ç™ºè¡¨ã®æ§‹æˆã‚’æ±ºã‚ã‚‹ã“ã¨ã€‚&#10;å…ˆé€±ã¯æ–‡çŒ®èª¿æŸ»ã‚’å®Ÿæ–½ã—ã€è«–æ–‡10æœ¬ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãŸã€‚&#10;å•é¡Œç‚¹ã¨ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿åé›†ã®é…ã‚ŒãŒã‚ã‚‹ã€‚&#10;æ¬¡å›ã¾ã§ã«å±±ç”°ãŒã‚°ãƒ©ãƒ•3æšä½œæˆã€ä½è—¤ãŒåˆ†æçµæœã¾ã¨ã‚ã€æ˜å¾Œæ—¥ã¾ã§ã«å®Œæˆã•ã›ã‚‹ã€‚&#10;æ±ºã¾ã£ãŸã“ã¨ã¯ã€ä¸­é–“ç™ºè¡¨ã¯1æœˆ15æ—¥ã«å®Ÿæ–½ã™ã‚‹ã“ã¨ã¨ã€é€±2å›ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†ã“ã¨ã€‚&#10;æ¬¡å›ã®ã‚´ãƒ¼ãƒ«ã¯åˆ†æçµæœã®å…±æœ‰ã€‚"
            />
            <button
              onClick={handleProcessWithAI}
              disabled={processing || inputText.trim().length < 50}
              className="mt-4 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition font-semibold"
            >
              {processing ? 'å‡¦ç†ä¸­...' : 'AIæ•´ç†ã™ã‚‹'}
            </button>
          </div>
        )}

        {/* Step 2: ç·¨é›†ãƒ»ç¢ºèªï¼ˆå„ªå…ˆé †ä½é †ï¼‰ */}
        {aiResult && (
          <div className="space-y-4">
            <div className="flex justify-between items-center">
              <h2 className="text-xl font-semibold text-gray-800">
                å†…å®¹ã‚’ç¢ºèªãƒ»ç·¨é›†
              </h2>
              <button
                onClick={() => setAiResult(null)}
                className="text-sm text-gray-600 hover:text-gray-800"
              >
                â† ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã«æˆ»ã‚‹
              </button>
            </div>

            {/* ğŸ”´ æœ€å„ªå…ˆ: æ±ºã¾ã£ãŸã“ã¨ï¼ˆèµ¤ï¼‰ */}
            <div className="bg-red-50 border-2 border-red-300 rounded-lg p-6">
              <h3 className="text-lg font-bold text-red-800 mb-1 flex items-center gap-2">
                ğŸ”´ æ±ºã¾ã£ãŸã“ã¨ï¼ˆDecisionï¼‰
              </h3>
              <p className="text-xs text-red-600 mb-4">æœ€é‡è¦ï¼ã“ã“ã‚’è¦‹ã‚Œã°ä»Šæ—¥ã®çµè«–ãŒåˆ†ã‹ã‚‹</p>
              {decisions.map((decision, i) => (
                <div key={i} className="mb-2">
                  <input
                    type="text"
                    value={decision}
                    onChange={(e) => {
                      const newDecisions = [...decisions];
                      newDecisions[i] = e.target.value;
                      setDecisions(newDecisions);
                    }}
                    className="w-full p-3 border-2 border-red-200 rounded-lg text-lg font-semibold"
                    placeholder={`æ±ºã¾ã£ãŸã“ã¨ ${i + 1}`}
                    maxLength={50}
                  />
                </div>
              ))}
              <button
                onClick={() => setDecisions([...decisions, ''])}
                className="mt-2 px-4 py-2 bg-red-200 rounded-lg hover:bg-red-300 text-sm font-semibold"
              >
                + è¿½åŠ 
              </button>
            </div>

            {/* ğŸŸ  æ¬¡å›ã¾ã§ã®ToDoï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ï¼‰ */}
            <div className="bg-orange-50 border-2 border-orange-300 rounded-lg p-6">
              <div className="flex justify-between items-center mb-4">
                <div>
                  <h3 className="text-lg font-bold text-orange-800 flex items-center gap-2">
                    ğŸŸ  æ¬¡å›ã¾ã§ã®ToDo
                  </h3>
                  <p className="text-xs text-orange-600">èª°ãŒãƒ»ã„ã¤ãƒ»ä½•ã‚’ãƒ»ã©ã“ã¾ã§</p>
                </div>
                <button
                  onClick={addTodo}
                  className="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-semibold"
                >
                  + ToDoè¿½åŠ 
                </button>
              </div>
              <div className="overflow-x-auto">
                <table className="w-full border-collapse border-2 border-orange-300">
                  <thead className="bg-orange-100">
                    <tr>
                      <th className="border border-orange-300 p-2 text-sm font-bold">No</th>
                      <th className="border border-orange-300 p-2 text-sm font-bold">ã‚„ã‚‹ã“ã¨ï¼ˆæˆæœç‰©ï¼‰</th>
                      <th className="border border-orange-300 p-2 text-sm font-bold">èª°ãŒ</th>
                      <th className="border border-orange-300 p-2 text-sm font-bold">ã„ã¤</th>
                      <th className="border border-orange-300 p-2 text-sm font-bold">æœŸé™</th>
                      <th className="border border-orange-300 p-2 text-sm font-bold">ã‚´ãƒ¼ãƒ«</th>
                      <th className="border border-orange-300 p-2 text-sm font-bold">å‰Šé™¤</th>
                    </tr>
                  </thead>
                  <tbody>
                    {todos.map((todo, i) => (
                      <tr key={i} className="bg-white">
                        <td className="border border-orange-300 p-2 text-center font-bold">{todo.no}</td>
                        <td className="border border-orange-300 p-2">
                          <input
                            type="text"
                            value={todo.task}
                            onChange={(e) => updateTodo(i, 'task', e.target.value)}
                            className="w-full p-2 border border-orange-200 rounded font-semibold"
                            placeholder="ä¾‹: ã‚°ãƒ©ãƒ•3æš+èª¬æ˜æ–‡"
                          />
                        </td>
                        <td className="border border-orange-300 p-2">
                          <input
                            type="text"
                            value={todo.assignee}
                            onChange={(e) => updateTodo(i, 'assignee', e.target.value)}
                            className="w-full p-2 border border-orange-200 rounded"
                            placeholder="å±±ç”°"
                          />
                        </td>
                        <td className="border border-orange-300 p-2">
                          <input
                            type="text"
                            value={todo.when}
                            onChange={(e) => updateTodo(i, 'when', e.target.value)}
                            className="w-full p-2 border border-orange-200 rounded"
                            placeholder="æ˜æ—¥"
                          />
                        </td>
                        <td className="border border-orange-300 p-2">
                          <input
                            type="text"
                            value={todo.deadline}
                            onChange={(e) => updateTodo(i, 'deadline', e.target.value)}
                            className="w-full p-2 border border-orange-200 rounded font-semibold text-red-600"
                            placeholder="12/25"
                          />
                        </td>
                        <td className="border border-orange-300 p-2">
                          <input
                            type="text"
                            value={todo.goal}
                            onChange={(e) => updateTodo(i, 'goal', e.target.value)}
                            className="w-full p-2 border border-orange-200 rounded"
                            placeholder="å®Œæˆ"
                          />
                        </td>
                        <td className="border border-orange-300 p-2 text-center">
                          <button
                            onClick={() => removeTodo(i)}
                            className="text-red-600 hover:text-red-800 font-bold"
                          >
                            Ã—
                          </button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>

            {/* ğŸŸ¡ æ¬¡å›MTGï¼ˆé»„è‰²ï¼‰ */}
            <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-6">
              <h3 className="text-lg font-bold text-yellow-800 mb-4 flex items-center gap-2">
                ğŸŸ¡ æ¬¡å›ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°
              </h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-semibold text-yellow-800 mb-1">
                    æ¬¡å›MTGæ—¥æ™‚
                  </label>
                  <input
                    type="datetime-local"
                    value={nextMeetingDate}
                    onChange={(e) => setNextMeetingDate(e.target.value)}
                    className="w-full p-3 border-2 border-yellow-300 rounded-lg font-semibold"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-yellow-800 mb-1">
                    æ¬¡å›ã®ã‚´ãƒ¼ãƒ«
                  </label>
                  <input
                    type="text"
                    value={nextMeetingGoal}
                    onChange={(e) => setNextMeetingGoal(e.target.value)}
                    maxLength={30}
                    className="w-full p-3 border-2 border-yellow-300 rounded-lg font-semibold"
                    placeholder="ä¾‹: åˆ†æçµæœã®å…±æœ‰"
                  />
                </div>
              </div>
            </div>

            {/* è©³ç´°æƒ…å ±ï¼ˆæŠ˜ã‚ŠãŸãŸã¿ï¼‰ */}
            <div className="bg-white border border-gray-300 rounded-lg">
              <button
                onClick={() => setShowDetails(!showDetails)}
                className="w-full p-4 text-left flex justify-between items-center hover:bg-gray-50"
              >
                <span className="font-semibold text-gray-800">
                  ğŸ“ è©³ç´°æƒ…å ±ï¼ˆåŸºæœ¬æƒ…å ±ãƒ»ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«ãƒ»Checkãƒ»Problemç­‰ï¼‰
                </span>
                <span className="text-gray-500">{showDetails ? 'â–²' : 'â–¼'}</span>
              </button>

              {showDetails && (
                <div className="p-6 border-t space-y-6">
                  {/* åŸºæœ¬æƒ…å ± */}
                  <div>
                    <h4 className="font-semibold text-gray-800 mb-3">åŸºæœ¬æƒ…å ±</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">æ—¥ä»˜</label>
                        <input
                          type="date"
                          value={date}
                          onChange={(e) => setDate(e.target.value)}
                          className="w-full p-2 border border-gray-300 rounded-lg"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">å‚åŠ è€…</label>
                        <div className="flex gap-2 mb-2">
                          <input
                            type="text"
                            value={participantInput}
                            onChange={(e) => setParticipantInput(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), addParticipant())}
                            placeholder="åå‰ã‚’å…¥åŠ›ã—ã¦Enter"
                            className="flex-1 p-2 border border-gray-300 rounded-lg"
                          />
                          <button
                            onClick={addParticipant}
                            className="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300"
                          >
                            è¿½åŠ 
                          </button>
                        </div>
                        <div className="flex flex-wrap gap-2">
                          {participants.map((p, i) => (
                            <span key={i} className="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm flex items-center gap-1">
                              {p}
                              <button onClick={() => removeParticipant(i)} className="text-blue-600 hover:text-blue-800">Ã—</button>
                            </span>
                          ))}
                        </div>
                      </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">ä¸­é–“ç™ºè¡¨æ—¥</label>
                        <input
                          type="date"
                          value={midtermDate}
                          onChange={(e) => setMidtermDate(e.target.value)}
                          className="w-full p-2 border border-gray-300 rounded-lg"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">æœ€çµ‚ç™ºè¡¨æ—¥</label>
                        <input
                          type="date"
                          value={finalDate}
                          onChange={(e) => setFinalDate(e.target.value)}
                          className="w-full p-2 border border-gray-300 rounded-lg"
                        />
                      </div>
                    </div>
                  </div>

                  {/* ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ« */}
                  <div>
                    <h4 className="font-semibold text-gray-800 mb-2">ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«</h4>
                    <input
                      type="text"
                      value={todayGoal}
                      onChange={(e) => setTodayGoal(e.target.value)}
                      maxLength={30}
                      className="w-full p-2 border border-gray-300 rounded-lg"
                      placeholder="ä¾‹: ä¸­é–“ç™ºè¡¨ã®æ§‹æˆã‚’æ±ºã‚ã‚‹"
                    />
                  </div>

                  {/* Check */}
                  <div>
                    <h4 className="font-semibold text-gray-800 mb-2">Checkï¼ˆå…ˆé€±ã‚„ã£ãŸã“ã¨ï¼‰</h4>
                    {lastWeekActions.map((action, i) => (
                      <div key={i} className="mb-2">
                        <input
                          type="text"
                          value={action}
                          onChange={(e) => {
                            const newActions = [...lastWeekActions];
                            newActions[i] = e.target.value;
                            setLastWeekActions(newActions);
                          }}
                          className="w-full p-2 border border-gray-300 rounded-lg"
                          placeholder={`${i + 1}. ã‚„ã£ãŸã“ã¨ï¼šçµæœ`}
                          maxLength={50}
                        />
                      </div>
                    ))}
                  </div>

                  {/* Problem */}
                  <div>
                    <h4 className="font-semibold text-gray-800 mb-2">Problemï¼ˆå›°ã£ã¦ã„ã‚‹ã“ã¨ï¼‰</h4>
                    <textarea
                      value={problems}
                      onChange={(e) => setProblems(e.target.value)}
                      className="w-full h-20 p-2 border border-gray-300 rounded-lg"
                      placeholder="ãªã‘ã‚Œã°ç©ºæ¬„ã§OK"
                      maxLength={100}
                    />
                  </div>

                  {/* æ¬¡å›æŒã£ã¦ã„ãã‚‚ã® */}
                  <div>
                    <h4 className="font-semibold text-gray-800 mb-2">æ¬¡å›æŒã£ã¦ã„ãã‚‚ã®</h4>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                      <div>
                        <label className="block text-sm text-gray-700 mb-1">å›³</label>
                        <input type="number" value={nextDeliverablesFigures} onChange={(e) => setNextDeliverablesFigures(Number(e.target.value))} className="w-full p-2 border border-gray-300 rounded-lg" min="0" />
                      </div>
                      <div>
                        <label className="block text-sm text-gray-700 mb-1">è¡¨</label>
                        <input type="number" value={nextDeliverablesTables} onChange={(e) => setNextDeliverablesTables(Number(e.target.value))} className="w-full p-2 border border-gray-300 rounded-lg" min="0" />
                      </div>
                      <div>
                        <label className="block text-sm text-gray-700 mb-1">ã‚¹ãƒ©ã‚¤ãƒ‰</label>
                        <input type="number" value={nextDeliverablesSlides} onChange={(e) => setNextDeliverablesSlides(Number(e.target.value))} className="w-full p-2 border border-gray-300 rounded-lg" min="0" />
                      </div>
                      <div>
                        <label className="block text-sm text-gray-700 mb-1">æ–‡ç« ï¼ˆå­—æ•°ï¼‰</label>
                        <input type="number" value={nextDeliverablesWords} onChange={(e) => setNextDeliverablesWords(Number(e.target.value))} className="w-full p-2 border border-gray-300 rounded-lg" min="0" />
                      </div>
                    </div>
                  </div>

                  {/* ã‚¿ã‚° */}
                  <div>
                    <h4 className="font-semibold text-gray-800 mb-2">ã‚¿ã‚°</h4>
                    <div className="flex gap-2 mb-2">
                      <input
                        type="text"
                        value={tagInput}
                        onChange={(e) => setTagInput(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), addTag())}
                        placeholder="ã‚¿ã‚°ã‚’å…¥åŠ›ã—ã¦Enter"
                        className="flex-1 p-2 border border-gray-300 rounded-lg"
                      />
                      <button onClick={addTag} className="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">è¿½åŠ </button>
                    </div>
                    <div className="flex flex-wrap gap-2">
                      {tags.map((tag, i) => (
                        <span key={i} className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm flex items-center gap-1">
                          {tag}
                          <button onClick={() => removeTag(i)} className="text-green-600 hover:text-green-800">Ã—</button>
                        </span>
                      ))}
                    </div>
                  </div>
                </div>
              )}
            </div>

            {/* ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆå¸¸ã«è¡¨ç¤ºï¼‰ */}
            <div className="bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-300 rounded-lg p-6">
              <h3 className="text-xl font-bold text-purple-800 mb-1 flex items-center gap-2">
                ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜
              </h3>
              <p className="text-sm text-purple-600 mb-4">
                ç ”ç©¶è³‡æ–™ã€ç™ºè¡¨å‹•ç”»ã€Word/PDF/Excelãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
              </p>

              {user && (
                <FileUploader
                  userId={user.uid}
                  onFileUploaded={(file) => setAttachedFiles([...attachedFiles, file])}
                />
              )}

              {/* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ */}
              {attachedFiles.length > 0 && (
                <div className="mt-6">
                  <h4 className="font-semibold text-purple-700 mb-3">
                    âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ« ({attachedFiles.length}ä»¶)
                  </h4>
                  <div className="space-y-2">
                    {attachedFiles.map((file, index) => (
                      <div key={file.id} className="flex items-center justify-between p-3 bg-white rounded-lg border border-purple-200 shadow-sm">
                        <div className="flex-1">
                          <p className="font-medium text-gray-900">{file.fileName}</p>
                          <p className="text-xs text-gray-500">
                            {file.fileType} â€¢ {(file.fileSize / 1024).toFixed(1)} KB
                          </p>
                          {file.description && (
                            <p className="text-sm text-gray-600 mt-1">{file.description}</p>
                          )}
                        </div>
                        <button
                          onClick={() => setAttachedFiles(attachedFiles.filter((_, i) => i !== index))}
                          className="ml-3 px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600"
                        >
                          å‰Šé™¤
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>

            {/* ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ï¼ˆæŠ˜ã‚ŠãŸãŸã¿ï¼‰ */}
            <div className="bg-white border border-gray-300 rounded-lg">
              <button
                onClick={() => setShowMilestones(!showMilestones)}
                className="w-full p-4 text-left flex justify-between items-center hover:bg-gray-50"
              >
                <span className="font-semibold text-gray-800">
                  ğŸ¯ ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ç®¡ç†ï¼ˆä¸­é–“ãƒ»æœ€çµ‚ç™ºè¡¨ã®é€²æ—ï¼‰
                </span>
                <span className="text-gray-500">{showMilestones ? 'â–²' : 'â–¼'}</span>
              </button>

              {showMilestones && (
                <div className="p-6 border-t">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <h4 className="font-semibold text-gray-700 mb-2">ä¸­é–“ç™ºè¡¨ã¾ã§ã®éšæ®µ</h4>
                      <div className="space-y-2">
                        {midtermMilestones.map((milestone, i) => (
                          <label key={i} className="flex items-center gap-2 cursor-pointer p-2 hover:bg-gray-50 rounded">
                            <input type="checkbox" checked={milestone.completed} onChange={() => toggleMilestone('midterm', i)} className="w-5 h-5" />
                            <span className={milestone.completed ? 'line-through text-gray-500' : 'font-medium'}>{milestone.label}</span>
                          </label>
                        ))}
                      </div>
                    </div>
                    <div>
                      <h4 className="font-semibold text-gray-700 mb-2">æœ€çµ‚ç™ºè¡¨ã¾ã§ã®éšæ®µ</h4>
                      <div className="space-y-2">
                        {finalMilestones.map((milestone, i) => (
                          <label key={i} className="flex items-center gap-2 cursor-pointer p-2 hover:bg-gray-50 rounded">
                            <input type="checkbox" checked={milestone.completed} onChange={() => toggleMilestone('final', i)} className="w-5 h-5" />
                            <span className={milestone.completed ? 'line-through text-gray-500' : 'font-medium'}>{milestone.label}</span>
                          </label>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </div>

            {/* ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */}
            {error && (
              <div className="p-4 bg-red-100 text-red-700 rounded-lg border-2 border-red-300 font-semibold">
                {error}
              </div>
            )}

            {/* ä¿å­˜ãƒœã‚¿ãƒ³ */}
            <div className="flex gap-4 sticky bottom-4 bg-white p-4 rounded-lg shadow-lg border-2 border-gray-300">
              <button
                onClick={() => handleSave('draft')}
                disabled={saving}
                className="flex-1 bg-gray-600 text-white px-6 py-4 rounded-lg hover:bg-gray-700 disabled:bg-gray-300 transition font-bold text-lg"
              >
                {saving ? 'ä¿å­˜ä¸­...' : 'ä¸‹æ›¸ãä¿å­˜'}
              </button>
              <button
                onClick={() => handleSave('confirmed')}
                disabled={saving}
                className="flex-1 bg-blue-600 text-white px-6 py-4 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 transition font-bold text-lg"
              >
                {saving ? 'ä¿å­˜ä¸­...' : 'ç¢ºå®šã—ã¦ä¿å­˜'}
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

========================================
10. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ - app/upload/page.tsx
========================================

'use client';

import { useAuth } from '@/components/auth/AuthProvider';
import { useRouter } from 'next/navigation';
import { useEffect, useState } from 'react';
import { AttachedFile } from '@/types';
import { db } from '@/lib/firebase';
import { collection, addDoc, serverTimestamp } from 'firebase/firestore';
import FileUploader from '@/components/files/FileUploader';

export default function UploadPage() {
  const { user, loading } = useAuth();
  const router = useRouter();
  const [uploadedFiles, setUploadedFiles] = useState<AttachedFile[]>([]);
  const [title, setTitle] = useState('');
  const [description, setDescription] = useState('');
  const [tags, setTags] = useState<string[]>([]);
  const [tagInput, setTagInput] = useState('');
  const [saving, setSaving] = useState(false);

  useEffect(() => {
    if (!loading && !user) {
      router.push('/');
    }
  }, [user, loading, router]);

  const addTag = () => {
    if (tagInput.trim() && !tags.includes(tagInput.trim())) {
      setTags([...tags, tagInput.trim()]);
      setTagInput('');
    }
  };

  const removeTag = (index: number) => {
    setTags(tags.filter((_, i) => i !== index));
  };

  const handleSave = async () => {
    if (!user) return;

    if (uploadedFiles.length === 0) {
      alert('å°‘ãªãã¨ã‚‚1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„');
      return;
    }

    setSaving(true);

    try {
      console.log('=== ä¿å­˜é–‹å§‹ ===');
      console.log('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«æ•°:', uploadedFiles.length);

      // å„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚µã‚¤ã‚ºã‚’ãƒ­ã‚°å‡ºåŠ›
      uploadedFiles.forEach((file, index) => {
        const base64Size = file.fileUrl ? file.fileUrl.length : 0;
        console.log(`ãƒ•ã‚¡ã‚¤ãƒ«${index + 1}: ${file.fileName}`);
        console.log(`  - å…ƒã®ã‚µã‚¤ã‚º: ${(file.fileSize / 1024).toFixed(2)}KB`);
        console.log(`  - Base64ã‚µã‚¤ã‚º: ${(base64Size / 1024).toFixed(2)}KB`);
      });

      // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨ä½“ã®ã‚µã‚¤ã‚ºã‚’è¨ˆç®—ï¼ˆæ¦‚ç®—ï¼‰
      const docData = {
        userId: user.uid,
        inputMode: 'upload',
        date: new Date().toISOString().split('T')[0],
        participants: null,
        todayGoal: title.trim() || 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–',
        decisions: null,
        todos: null,
        problems: description.trim() || null,
        lastWeekActions: null,
        weeklySchedule: null,
        nextDeliverables: null,
        nextMeetingDate: null,
        nextMeetingGoal: null,
        midtermMilestones: null,
        finalMilestones: null,
        attachedFiles: uploadedFiles,
        tags: tags.length > 0 ? tags : null,
        status: 'confirmed',
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
      };

      // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’æ¦‚ç®—ï¼ˆJSONæ–‡å­—åˆ—åŒ–ï¼‰
      const docSize = new Blob([JSON.stringify(docData)]).size;
      const docSizeMB = (docSize / (1024 * 1024)).toFixed(2);
      const docSizeKB = (docSize / 1024).toFixed(2);

      console.log(`ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨ä½“ã®ã‚µã‚¤ã‚º: ${docSizeKB}KB (${docSizeMB}MB, ${docSize}ãƒã‚¤ãƒˆ)`);

      if (docSize > 1048576) { // 1MB = 1048576ãƒã‚¤ãƒˆ
        alert(`ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™: ${docSizeMB}MB (${docSizeKB}KB)\n\nFirestoreã®åˆ¶é™: 1MBä»¥å†…\n\nã‚ˆã‚Šå°ã•ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚`);
        setSaving(false);
        return;
      }

      console.log('Firestoreã«ä¿å­˜é–‹å§‹...');
      // ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã¨ã—ã¦ä¿å­˜ï¼ˆè­°äº‹éŒ²å½¢å¼ã§ä¿å­˜ï¼‰
      const docRef = await addDoc(collection(db, 'minutes'), docData);
      console.log('ä¿å­˜æˆåŠŸï¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆID:', docRef.id);

      alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
      router.push('/archives');
    } catch (error: any) {
      console.error('=== ä¿å­˜ã‚¨ãƒ©ãƒ¼ ===');
      console.error('ã‚¨ãƒ©ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:', error);
      console.error('ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:', error.message);
      console.error('ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰:', error.code);
      console.error('ã‚¨ãƒ©ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯:', error.stack);

      let errorMsg = 'ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ\n\n';
      if (error.code) {
        errorMsg += `ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ${error.code}\n`;
      }
      if (error.message) {
        errorMsg += `è©³ç´°: ${error.message}\n`;
      }
      errorMsg += '\nãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã§è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';

      alert(errorMsg);
    } finally {
      setSaving(false);
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <p className="text-gray-600">èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-4xl mx-auto px-4">
        {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
        <div className="mb-6">
          <button
            onClick={() => router.push('/dashboard')}
            className="text-blue-600 hover:text-blue-800 mb-2 flex items-center gap-1"
          >
            â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
          </button>
          <h1 className="text-3xl font-bold text-gray-900">ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h1>
          <p className="text-gray-600 mt-2">
            ç ”ç©¶è³‡æ–™ã€Word/PDF/Excelãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆæœ€å¤§500KBï¼‰
          </p>
          <p className="text-sm text-red-600 font-semibold mt-1">
            âš ï¸ Firestoreç„¡æ–™ç‰ˆã®ãŸã‚ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯500KBä»¥ä¸‹ã«åˆ¶é™ã•ã‚Œã¦ã„ã¾ã™
          </p>
        </div>

        <div className="space-y-6">
          {/* ã‚¿ã‚¤ãƒˆãƒ« */}
          <div className="bg-white rounded-lg shadow p-6">
            <label className="block text-sm font-bold text-gray-700 mb-2">
              ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä»»æ„ï¼‰
            </label>
            <input
              type="text"
              value={title}
              onChange={(e) => setTitle(e.target.value)}
              placeholder="ä¾‹: å’æ¥­ç ”ç©¶ç™ºè¡¨è³‡æ–™ã€å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã¾ã¨ã‚"
              className="w-full p-3 border border-gray-300 rounded-lg"
            />
          </div>

          {/* èª¬æ˜ */}
          <div className="bg-white rounded-lg shadow p-6">
            <label className="block text-sm font-bold text-gray-700 mb-2">
              èª¬æ˜ï¼ˆä»»æ„ï¼‰
            </label>
            <textarea
              value={description}
              onChange={(e) => setDescription(e.target.value)}
              placeholder="ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚„ç›®çš„ã‚’èª¬æ˜ã—ã¦ãã ã•ã„"
              rows={4}
              className="w-full p-3 border border-gray-300 rounded-lg"
            />
          </div>

          {/* ã‚¿ã‚° */}
          <div className="bg-white rounded-lg shadow p-6">
            <label className="block text-sm font-bold text-gray-700 mb-2">
              ã‚¿ã‚°ï¼ˆä»»æ„ï¼‰
            </label>
            <div className="flex gap-2 mb-3">
              <input
                type="text"
                value={tagInput}
                onChange={(e) => setTagInput(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), addTag())}
                placeholder="ã‚¿ã‚°ã‚’å…¥åŠ›ã—ã¦Enterï¼ˆä¾‹: ç ”ç©¶ç™ºè¡¨ã€å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ï¼‰"
                className="flex-1 p-2 border border-gray-300 rounded-lg"
              />
              <button
                onClick={addTag}
                className="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300"
              >
                è¿½åŠ 
              </button>
            </div>
            {tags.length > 0 && (
              <div className="flex flex-wrap gap-2">
                {tags.map((tag, i) => (
                  <span
                    key={i}
                    className="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm flex items-center gap-1"
                  >
                    {tag}
                    <button
                      onClick={() => removeTag(i)}
                      className="text-blue-600 hover:text-blue-800 font-bold"
                    >
                      Ã—
                    </button>
                  </span>
                ))}
              </div>
            )}
          </div>

          {/* ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ */}
          <div className="bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-300 rounded-lg p-6">
            <h3 className="text-xl font-bold text-purple-800 mb-1 flex items-center gap-2">
              ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
            </h3>
            <p className="text-sm text-purple-600 mb-4">
              Wordã€PDFã€Excelã€ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãªã©ï¼ˆæœ€å¤§500KBï¼‰
            </p>

            {user && (
              <FileUploader
                userId={user.uid}
                onFileUploaded={(file) => setUploadedFiles([...uploadedFiles, file])}
              />
            )}

            {/* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ */}
            {uploadedFiles.length > 0 && (
              <div className="mt-6">
                <h4 className="font-semibold text-purple-700 mb-3">
                  âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ« ({uploadedFiles.length}ä»¶)
                </h4>
                <div className="space-y-2">
                  {uploadedFiles.map((file, index) => (
                    <div
                      key={file.id}
                      className="flex items-center justify-between p-3 bg-white rounded-lg border border-purple-200 shadow-sm"
                    >
                      <div className="flex-1">
                        <p className="font-medium text-gray-900">{file.fileName}</p>
                        <p className="text-xs text-gray-500">
                          {file.fileType} â€¢ {(file.fileSize / 1024).toFixed(1)} KB
                        </p>
                        {file.description && (
                          <p className="text-sm text-gray-600 mt-1">{file.description}</p>
                        )}
                      </div>
                      <button
                        onClick={() =>
                          setUploadedFiles(uploadedFiles.filter((_, i) => i !== index))
                        }
                        className="ml-3 px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600"
                      >
                        å‰Šé™¤
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>

          {/* ä¿å­˜ãƒœã‚¿ãƒ³ */}
          <div className="flex gap-4">
            <button
              onClick={() => router.push('/dashboard')}
              className="flex-1 px-6 py-4 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-bold text-lg"
              disabled={saving}
            >
              ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </button>
            <button
              onClick={handleSave}
              disabled={saving || uploadedFiles.length === 0}
              className="flex-1 px-6 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 font-bold text-lg"
            >
              {saving ? 'ä¿å­˜ä¸­...' : 'ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã«ä¿å­˜'}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

========================================
11. AIå‡¦ç†API - app/api/ai/process/route.ts
========================================

// AIè¦ç´„APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
import { NextRequest, NextResponse } from 'next/server';
import { processMinuteWithAI } from '@/lib/gemini';

export async function POST(request: NextRequest) {
  try {
    const { inputText } = await request.json();

    if (!inputText || inputText.trim().length < 50) {
      return NextResponse.json(
        { error: 'å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã¯50æ–‡å­—ä»¥ä¸Šå¿…è¦ã§ã™' },
        { status: 400 }
      );
    }

    const result = await processMinuteWithAI(inputText);

    return NextResponse.json(result);
  } catch (error) {
    console.error('API ã‚¨ãƒ©ãƒ¼:', error);
    return NextResponse.json(
      { error: 'AIå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' },
      { status: 500 }
    );
  }
}

========================================
12. PWAè¨­å®š - public/manifest.json
========================================

{
  "name": "ç ”ç©¶å®¤ãƒã‚¦ãƒã‚¦è“„ç©ã‚·ã‚¹ãƒ†ãƒ ",
  "short_name": "ç ”ç©¶å®¤ãƒã‚¦ãƒã‚¦",
  "description": "ç ”ç©¶å®¤ã®è­°äº‹éŒ²ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#3b82f6",
  "orientation": "portrait-primary",
  "icons": [
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ]
}

========================================
13. ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰ - README.mdï¼ˆæŠœç²‹ï¼‰
========================================

# ğŸ“š ç ”ç©¶å®¤ãƒã‚¦ãƒã‚¦è“„ç©ã‚·ã‚¹ãƒ†ãƒ 

ç ”ç©¶å®¤ã®ã‚¼ãƒŸè­°äº‹éŒ²ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†ã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https://github.com/YOUR_USERNAME/lab-knowledge-system)

## âœ¨ ä¸»ãªæ©Ÿèƒ½

### ğŸ“ è­°äº‹éŒ²ç®¡ç†
- **AIè‡ªå‹•æ•´ç†**: Gemini 2.5 Flashã§ãƒ†ã‚­ã‚¹ãƒˆã‚’AIå‡¦ç†
- **æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿**: æ±ºã¾ã£ãŸã“ã¨ã€ToDoã€å•é¡Œç‚¹ãªã©ã‚’æ•´ç†
- **æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: ã‚¿ã‚°ã€æ—¥ä»˜ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§æ¤œç´¢

### ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: Wordã€PDFã€Excelã€ç”»åƒï¼ˆæœ€å¤§500KBï¼‰
- **Base64ä¿å­˜**: Firebase Storageä¸è¦ã§å®Œå…¨ç„¡æ–™
- **å¹´åº¦åˆ¥æ•´ç†**: å¹´åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¨ã‚°ãƒ«ãƒ¼ãƒ—åŒ–è¡¨ç¤º
- **æ¤œç´¢æ©Ÿèƒ½**: ãƒ•ã‚¡ã‚¤ãƒ«åã€èª¬æ˜ã€ã‚¿ã‚°ã§æ¤œç´¢

### ğŸ”’ èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **Googleèªè¨¼**: Firebase Authentication
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ç®¡ç†**: å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†é›¢

### ğŸ“± PWAå¯¾å¿œ
- **ãƒ›ãƒ¼ãƒ ç”»é¢è¿½åŠ **: ã‚¹ãƒãƒ›ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ç”¨å¯èƒ½
- **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ**: ï¼ˆä»Šå¾Œå®Ÿè£…å¯èƒ½ï¼‰

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•

è©³ç´°ã¯ [QUICK_START.md](./QUICK_START.md) ã‚’å‚ç…§

### ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

1. **GitHubã«push**
   ```bash
   git remote add origin https://github.com/YOUR_USERNAME/lab-knowledge-system.git
   git push -u origin main
   ```

2. **Vercelã§ãƒ‡ãƒ—ãƒ­ã‚¤**
   - https://vercel.com ã§GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
   - ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
   - ãƒ‡ãƒ—ãƒ­ã‚¤ï¼

3. **Firebaseè¨­å®šæ›´æ–°**
   - æ‰¿èªæ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³ã«Vercel URLã‚’è¿½åŠ 

---

## ğŸ’» ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º

### å¿…è¦ãªã‚‚ã®
- Node.js 18ä»¥ä¸Š
- Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
- Gemini API ã‚­ãƒ¼

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. **ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³**
   ```bash
   git clone https://github.com/YOUR_USERNAME/lab-knowledge-system.git
   cd lab-knowledge-system
   ```

2. **ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   ```bash
   npm install
   ```

3. **ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š**
   `.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š
   ```env
   NEXT_PUBLIC_FIREBASE_API_KEY=your_api_key
   NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your_project.firebaseapp.com
   NEXT_PUBLIC_FIREBASE_PROJECT_ID=your_project_id
   NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your_project.appspot.com
   NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
   NEXT_PUBLIC_FIREBASE_APP_ID=your_app_id
   GEMINI_API_KEY=your_gemini_api_key
   ```

4. **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•**
   ```bash
   npm run dev
   ```

5. **ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã**
   http://localhost:3000

---

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Next.js 16 (App Router), React, TypeScript
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: Tailwind CSS
- **èªè¨¼**: Firebase Authentication
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Cloud Firestore
- **AI**: Google Gemini 2.5 Flash API

========================================
14. ç’°å¢ƒå¤‰æ•°ï¼ˆ.env.localï¼‰- å®Ÿéš›ã®å€¤ã¯éå…¬é–‹
========================================
NEXT_PUBLIC_FIREBASE_API_KEY=***
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=***.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=***
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=***.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=***
NEXT_PUBLIC_FIREBASE_APP_ID=***
GEMINI_API_KEY=***

========================================
å®Œæˆï¼
========================================

